#
# Software Copyright BAE Systems plc 2017. All Rights Reserved.
# BAE SYSTEMS, DETICA are trademarks of BAE Systems
# plc and may be registered in certain jurisdictions.
#
---

- name: check firewalld is stopped and is not running at boot time.
  ignore_errors: yes
  service: name=firewalld state=stopped enabled=no

- name: copy ambari repo template
  template:
    src: "ambari.repo"
    dest: "/etc/yum.repos.d/ambari.repo"
 
- name: changing ambari to local repo 
  replace:
    dest: "/etc/yum.repos.d/ambari.repo"
    regexp: '{{ item.regexp }}'
    replace: '{{ item.word }}'
  with_items:
    - { regexp: '<AMBARI_VERSION>', word: '{{ ambari_version }}' }
    - { regexp: '<REPO_URL>', word: '{{ local_ambari_repo_url }}' }

- name: Copy Mysql-community repo template
  template:
    src: "mysql-community.repo"
    dest: "/etc/yum.repos.d/mysql-community.repo"

- name: changing the mysql repo to ftp
  replace:
    dest: "/etc/yum.repos.d/mysql-community.repo"
    regexp: '{{ item.regexp }}'
    replace: '{{ item.word }}'
  with_items:
    - { regexp: '<MYSQL_REPO_URL>', word: '{{ mysql_repo_url }}' }

- name: Copy Mysql-community repo template
  template:
    src: "mysql-community.repo"
    dest: "/etc/yum.repos.d/mysql-community-source.repo"

- name: changing the mysql repo to ftp
  replace:
    dest: "/etc/yum.repos.d/mysql-community-source.repo"
    regexp: '{{ item.regexp }}'
    replace: '{{ item.word }}'
  with_items:
    - { regexp: '<MYSQL_REPO_URL>', word: '{{ mysql_repo_url }}' }


- name: create logrotate script for hadoop services
  template:
    src: "hadoop-logrotate.yml"
    dest: "/etc/logrotate.d/ambari"
    mode: 0644
